<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imóveis | Instituto Valentis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 15px;
            font-family: 'Arial', sans-serif;
        }
        .container {
            max-width: 100%;
        }
        h1, h2 {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 20px;
        }
        h2 {
            font-size: 1.5rem;
        }
        .property-card {
            border: none;
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .property-card:hover {
            transform: translateY(-5px);
        }
        .carousel img {
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        .carousel-control-prev, .carousel-control-next {
            width: 10%;
            background: rgba(0, 0, 0, 0.3);
        }
        .form-section {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        .form-control, .form-select {
            height: 48px;
            font-size: 1rem;
            margin-bottom: 10px;
        }
        textarea.form-control {
            height: 100px;
        }
        .btn-primary {
            height: 50px;
            font-size: 1.1rem;
            border-radius: 8px;
        }
        .alert {
            margin-top: 15px;
            border-radius: 8px;
            font-size: 1rem;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @media (max-width: 576px) {
            h1 { font-size: 1.5rem; }
            h2 { font-size: 1.2rem; }
            .property-card { padding: 10px; }
            .carousel img { height: 150px; }
            .form-control, .form-select { font-size: 0.9rem; }
            .btn-primary { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Imóveis em Ivatuba</h1>

        <!-- Seção de Exibição -->
        <div id="properties-list" class="row"></div>

        <!-- Seção de Cadastro -->
        <div class="form-section">
            <h2>Cadastrar Novo Imóvel</h2>
            <form id="property-form">
                <div class="row g-3">
                    <div class="col-12">
                        <label for="owner" class="form-label">Nome do Proprietário</label>
                        <input type="text" class="form-control" id="owner" required>
                    </div>
                    <div class="col-12">
                        <label for="type" class="form-label">Tipo</label>
                        <select class="form-select" id="type" required>
                            <option value="locacao">Locação</option>
                            <option value="venda">Venda</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label for="value" class="form-label">Valor (R$)</label>
                        <input type="number" class="form-control" id="value" step="0.01" required>
                    </div>
                    <div class="col-12">
                        <label for="description" class="form-label">Descrição</label>
                        <textarea class="form-control" id="description" required></textarea>
                    </div>
                    <div class="col-6">
                        <label for="bedrooms" class="form-label">Quartos</label>
                        <input type="number" class="form-control" id="bedrooms" required>
                    </div>
                    <div class="col-6">
                        <label for="suites" class="form-label">Suítes</label>
                        <input type="number" class="form-control" id="suites" required>
                    </div>
                    <div class="col-6">
                        <label for="livingrooms" class="form-label">Salas</label>
                        <input type="number" class="form-control" id="livingrooms" required>
                    </div>
                    <div class="col-6">
                        <label for="kitchens" class="form-label">Cozinhas</label>
                        <input type="number" class="form-control" id="kitchens" required>
                    </div>
                    <div class="col-6">
                        <label for="bathrooms" class="form-label">Banheiros</label>
                        <input type="number" class="form-control" id="bathrooms" required>
                    </div>
                    <div class="col-6">
                        <label for="garage" class="form-label">Garagem</label>
                        <select class="form-select" id="garage" required>
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label for="garage-spaces" class="form-label">Vagas na Garagem</label>
                        <input type="number" class="form-control" id="garage-spaces" disabled>
                    </div>
                    <div class="col-12">
                        <label for="email" class="form-label">E-mail de Contato</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="col-12">
                        <label for="phone" class="form-label">Telefone de Contato</label>
                        <input type="tel" class="form-control" id="phone" required>
                    </div>
                    <div class="col-12">
                        <label for="address" class="form-label">Endereço</label>
                        <input type="text" class="form-control" id="address" required>
                    </div>
                    <div class="col-6">
                        <label for="area" class="form-label">Área (m²)</label>
                        <input type="number" class="form-control" id="area" step="0.01" required>
                    </div>
                    <div class="col-6">
                        <label for="status" class="form-label">Status</label>
                        <select class="form-select" id="status" required>
                            <option value="disponivel">Disponível</option>
                            <option value="vendido">Vendido</option>
                            <option value="alugado">Alugado</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label for="photos" class="form-label">Fotos do Imóvel</label>
                        <input type="file" class="form-control" id="photos" accept="image/*" multiple>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary w-100">Cadastrar Imóvel</button>
                    </div>
                </div>
            </form>
            <div id="form-feedback" class="alert" style="display: none;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Carrega imóveis e acessos do localStorage ao iniciar
        let properties = JSON.parse(localStorage.getItem('properties')) || [];
        let accessLocations = JSON.parse(localStorage.getItem('accessLocations')) || [];

        // Função para exibir imóveis (apenas aprovados)
        function displayProperties() {
            const propertiesList = document.getElementById('properties-list');
            propertiesList.innerHTML = '';
            properties.filter(property => property.approvalStatus === 'approved').forEach((property, index) => {
                const photosHtml = property.photos.length > 0
                    ? `
                        <div id="carousel-${index}" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                ${property.photos.map((photo, i) => `
                                    <div class="carousel-item ${i === 0 ? 'active' : ''}">
                                        <img src="${photo}" class="d-block w-100" alt="Foto do imóvel">
                                    </div>
                                `).join('')}
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carousel-${index}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carousel-${index}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    `
                    : '<p class="text-muted">Sem fotos disponíveis</p>';

                const card = `
                    <div class="col-12">
                        <div class="property-card">
                            ${photosHtml}
                            <h3 class="mt-3">${property.owner}</h3>
                            <p><strong>Status:</strong> ${property.status.charAt(0).toUpperCase() + property.status.slice(1)}</p>
                            <p><strong>Tipo:</strong> ${property.type === 'locacao' ? 'Locação' : 'Venda'}</p>
                            <p><strong>Valor:</strong> R$ ${parseFloat(property.value).toFixed(2)}</p>
                            <details>
                                <summary>Mais Detalhes</summary>
                                <p><strong>Descrição:</strong> ${property.description}</p>
                                <p><strong>Quartos:</strong> ${property.bedrooms}</p>
                                <p><strong>Suítes:</strong> ${property.suites}</p>
                                <p><strong>Salas:</strong> ${property.livingrooms}</p>
                                <p><strong>Cozinhas:</strong> ${property.kitchens}</p>
                                <p><strong>Banheiros:</strong> ${property.bathrooms}</p>
                                <p><strong>Garagem:</strong> ${property.garage === 'sim' ? `Sim (${property.garageSpaces} vagas)` : 'Não'}</p>
                                <p><strong>Contato:</strong> ${property.email} | ${property.phone}</p>
                                <p><strong>Endereço:</strong> ${property.address}</p>
                                <p><strong>Área:</strong> ${property.area} m²</p>
                                <p><strong>Data de Publicação:</strong> ${property.date}</p>
                            </details>
                        </div>
                    </div>
                `;
                propertiesList.innerHTML += card;
            });
        }

        // Função para lidar com o upload de fotos
        function handlePhotos(files) {
            return Promise.all([...files].map(file => {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.readAsDataURL(file);
                });
            }));
        }

        // Função para obter localização
        function getLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve({ latitude: null, longitude: null });
                    return;
                }
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        });
                    },
                    () => {
                        resolve({ latitude: null, longitude: null });
                    }
                );
            });
        }

        // Captura localização ao acessar o site
        window.onload = async () => {
            const location = await getLocation();
            if (location.latitude && location.longitude) {
                accessLocations.push({
                    latitude: location.latitude,
                    longitude: location.longitude,
                    timestamp: new Date().toLocaleString('pt-BR')
                });
                localStorage.setItem('accessLocations', JSON.stringify(accessLocations));
            }
            displayProperties();
        };

        // Manipula o formulário
        document.getElementById('property-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const garage = document.getElementById('garage').value;
            const photos = document.getElementById('photos').files;
            const photoData = await handlePhotos(photos);
            const location = await getLocation();

            const property = {
                owner: document.getElementById('owner').value,
                type: document.getElementById('type').value,
                value: document.getElementById('value').value,
                description: document.getElementById('description').value,
                bedrooms: document.getElementById('bedrooms').value,
                suites: document.getElementById('suites').value,
                livingrooms: document.getElementById('livingrooms').value,
                kitchens: document.getElementById('kitchens').value,
                bathrooms: document.getElementById('bathrooms').value,
                garage: garage,
                garageSpaces: garage === 'sim' ? document.getElementById('garage-spaces').value : 0,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                area: document.getElementById('area').value,
                status: document.getElementById('status').value,
                date: new Date().toLocaleDateString('pt-BR'),
                photos: photoData,
                approvalStatus: 'pending',
                latitude: location.latitude,
                longitude: location.longitude
            };

            properties.push(property);
            localStorage.setItem('properties', JSON.stringify(properties));
            displayProperties();
            document.getElementById('property-form').reset();
            document.getElementById('garage-spaces').disabled = true;

            // Exibe mensagem de feedback
            const feedback = document.getElementById('form-feedback');
            feedback.innerHTML = 'Imóvel cadastrado com sucesso! Aguardando aprovação do administrador.';
            feedback.className = 'alert alert-success';
            feedback.style.display = 'block';
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 5000);
        });

        // Habilita/desabilita campo de vagas na garagem
        document.getElementById('garage').addEventListener('change', (e) => {
            const garageSpaces = document.getElementById('garage-spaces');
            garageSpaces.disabled = e.target.value === 'nao';
            if (e.target.value === 'nao') garageSpaces.value = '';
        });
    </script>
</body>
</html>