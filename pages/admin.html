<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Gerenciar Imóveis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 15px;
            font-family: 'Arial', sans-serif;
        }
        .admin-section {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 100%;
        }
        h1, h2, h3 {
            text-align: center;
            margin-bottom: 20px;
        }
        h1 { font-size: 1.8rem; }
        h2, h3 { font-size: 1.5rem; }
        .property-list, .access-list, .cadastro-list {
            margin-bottom: 20px;
        }
        .property-item, .access-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 10px;
        }
        .property-info {
            font-size: 1rem;
        }
        .btn {
            height: 45px;
            font-size: 1rem;
            border-radius: 8px;
            margin: 5px 0;
        }
        .form-control {
            height: 48px;
            font-size: 1rem;
        }
        .modal-content {
            border-radius: 12px;
        }
        .modal-body .form-control, .modal-body .form-select {
            height: 48px;
        }
        @media (max-width: 576px) {
            h1 { font-size: 1.5rem; }
            h2, h3 { font-size: 1.2rem; }
            .property-info { font-size: 0.9rem; }
            .btn { font-size: 0.9rem; height: 40px; }
            .form-control { font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="admin-section">
        <h1>Painel Administrativo</h1>
        <div id="auth-section">
            <h2>Acessar Painel</h2>
            <input type="password" id="admin-password" class="form-control mb-3" placeholder="Digite a senha">
            <button class="btn btn-primary w-100" onclick="authenticate()">Entrar</button>
        </div>
        <div id="admin-content" style="display: none;">
            <h2>Gerenciar Imóveis</h2>
            <h3>Imóveis Cadastrados</h3>
            <div class="property-list" id="property-list"></div>
            <div class="mb-3">
                <label for="delete-index" class="form-label">Índice do Imóvel para Excluir</label>
                <input type="number" id="delete-index" class="form-control" placeholder="Digite o índice">
            </div>
            <button class="btn btn-danger w-100" onclick="deleteProperty()">Excluir Imóvel</button>
            <h3>Localizações de Cadastro</h3>
            <div class="cadastro-list" id="cadastro-list"></div>
            <h3>Acessos ao Site</h3>
            <div class="access-list" id="access-list"></div>
        </div>
    </div>

    <!-- Modal para Editar Status -->
    <div class="modal fade" id="editStatusModal" tabindex="-1" aria-labelledby="editStatusModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editStatusModalLabel">Editar Status do Imóvel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-status-form">
                        <div class="mb-3">
                            <label for="edit-status" class="form-label">Novo Status</label>
                            <select class="form-select" id="edit-status" required>
                                <option value="disponivel">Disponível</option>
                                <option value="alugado">Alugado</option>
                                <option value="vendido">Vendido</option>
                            </select>
                        </div>
                        <input type="hidden" id="edit-index">
                        <button type="submit" class="btn btn-primary w-100">Salvar Alteração</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const ADMIN_PASSWORD = 'admin123'; // Senha estática (mude para algo seguro)

        // Autenticar administrador
        function authenticate() {
            const password = document.getElementById('admin-password').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                displayProperties();
                displayAccesses();
                displayCadastroLocations();
            } else {
                alert('Senha incorreta');
            }
        }

        // Carrega imóveis e acessos do localStorage
        let properties = JSON.parse(localStorage.getItem('properties')) || [];
        let accessLocations = JSON.parse(localStorage.getItem('accessLocations')) || [];

        // Exibe lista de imóveis
        function displayProperties() {
            const propertyList = document.getElementById('property-list');
            propertyList.innerHTML = '';
            properties.forEach((property, index) => {
                const item = document.createElement('div');
                item.className = 'property-item';
                const statusText = property.approvalStatus === 'pending' ? 'Pendente' : 'Aprovado';
                const locationText = property.latitude && property.longitude
                    ? `Lat ${property.latitude.toFixed(4)}, Long ${property.longitude.toFixed(4)}`
                    : 'Localização não fornecida';
                item.innerHTML = `
                    <div class="property-info">
                        <span><strong>Índice ${index}</strong>: ${property.owner} - ${property.address} (${statusText})</span>
                        <br>
                        <span><strong>Localização do Cadastro:</strong> ${locationText}</span>
                    </div>
                    <div class="d-flex flex-column gap-2">
                        ${property.approvalStatus === 'pending' ? `<button class="btn btn-success" onclick="approveProperty(${index})">Aprovar</button>` : ''}
                        <button class="btn btn-primary" onclick="openEditStatusModal(${index})">Editar Status</button>
                    </div>
                `;
                propertyList.appendChild(item);
            });
        }

        // Exibe lista de acessos
        function displayAccesses() {
            const accessList = document.getElementById('access-list');
            accessList.innerHTML = '';
            accessLocations.forEach((access, index) => {
                const item = document.createElement('div');
                item.className = 'access-item';
                const locationText = access.latitude && access.longitude
                    ? `Lat ${access.latitude.toFixed(4)}, Long ${access.longitude.toFixed(4)}`
                    : 'Localização não fornecida';
                item.innerHTML = `
                    <span><strong>Acesso ${index + 1}</strong>: ${locationText} (${access.timestamp})</span>
                `;
                accessList.appendChild(item);
            });
        }

        // Exibe lista de localizações de cadastro
        function displayCadastroLocations() {
            const cadastroList = document.getElementById('cadastro-list');
            cadastroList.innerHTML = '';
            properties.forEach((property, index) => {
                const item = document.createElement('div');
                item.className = 'access-item';
                const locationText = property.latitude && property.longitude
                    ? `Lat ${property.latitude.toFixed(4)}, Long ${property.longitude.toFixed(4)}`
                    : 'Localização não fornecida';
                item.innerHTML = `
                    <span><strong>Imóvel ${index}</strong>: ${locationText}</span>
                `;
                item.appendChild(item);
            });
        }

        // Aprova imóvel
        function approveProperty(index) {
            properties[index].approvalStatus = 'approved';
            localStorage.setItem('properties', JSON.stringify(properties));
            displayProperties();
            displayCadastroLocations();
        }

        // Abre o modal de edição de status
        function openEditStatusModal(index) {
            document.getElementById('edit-index').value = index;
            document.getElementById('edit-status').value = properties[index].status;
            new bootstrap.Modal(document.getElementById('editStatusModal')).show();
        }

        // Manipula o formulário de edição de status
        document.getElementById('edit-status-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const index = parseInt(document.getElementById('edit-index').value);
            const newStatus = document.getElementById('edit-status').value;
            properties[index].status = newStatus;
            localStorage.setItem('properties', JSON.stringify(properties));
            displayProperties();
            bootstrap.Modal.getInstance(document.getElementById('editStatusModal')).hide();
        });

        // Exclui imóvel
        function deleteProperty() {
            const index = parseInt(document.getElementById('delete-index').value);
            if (isNaN(index) || index < 0 || index >= properties.length) {
                alert('Índice inválido');
                return;
            }
            if (confirm('Tem certeza que deseja excluir este imóvel?')) {
                properties.splice(index, 1);
                localStorage.setItem('properties', JSON.stringify(properties));
                displayProperties();
                displayCadastroLocations();
                document.getElementById('delete-index').value = '';
            }
        }
    </script>
</body>
</html>